!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("@inertiajs/react"),require("lodash-es"),require("react/jsx-runtime"),require("axios")):"function"==typeof define&&define.amd?define(["exports","react","@inertiajs/react","lodash-es","react/jsx-runtime","axios"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).useInertiaForm={},e.React,e["@inertiajs/react"],e.lodashEs,e.jsxRuntime,e.axios)}(this,(function(e,t,r,n,s,o){"use strict";const u=()=>{const e=t.createContext(null);return[()=>{const r=t.useContext(e);if(null===r)throw new Error("useContext must be inside a Provider with a value");return r},e.Provider]},a=e=>{const t=structuredClone(e??{});for(const e in t)n.isPlainObject(t[e])?t[e]=a(t[e]):Array.isArray(t[e])?t[e]=t[e].map((e=>a(e))):void 0!==t[e]&&null!==t[e]||(t[e]="");return t},c=(e,t)=>{Object.entries(e).forEach((([r,s])=>{n.isPlainObject(s)?(i(e,r,`${r}${t}`),c(s,t)):Array.isArray(s)&&i(e,r,`${r}${t}`)}))},i=(e,t,r)=>{t!==r&&(e[r]=e[t],delete e[t])},l=(e,t)=>{const r=t.replace(/\[\]$/,"");if(r.includes("[]")){const t=r.indexOf("[]"),s=r.slice(0,t),o=r.slice(t+2),u=n.get(e,s);if(Array.isArray(u))for(let t=0;t<u.length;t++)l(e,`${s}[${t}]${o}`)}if("]"===r.charAt(r.length-1)){const t=r.match(/(?<index>\d*)\]$/),s=n.get(e,r.slice(0,r.lastIndexOf("[")));Array.isArray(s)&&void 0!==t?.groups?.index&&s.splice(Number(t.groups.index),1)}else n.unset(e,r)},d=(e,n)=>{const[s,o]=r.useRemember(e,n),[u,a]=t.useState(e);return n?[s,o]:[u,a]},f=e=>Array.isArray(e)?e:[e],[m,h]=u(),p=(e,t)=>{const r=new Set(e);return r.add(t),r},y=({children:e,model:r,railsAttributes:n})=>{const[o,u]=t.useReducer(p,new Set),a={nestedAttributes:o,addAttribute:u,model:r,railsAttributes:n};return s.jsx(h,{value:a,children:e})};function g(e,s){const u=t.useCallback((()=>{let t=null,r=e;return"string"==typeof e&&(t=e,r=s),[t,a(r)]}),[e,s]),[i,h]=u(),[p,y]=t.useState(h||{}),[g,b]=d(h,i?`${i}:data`:void 0),v=t.useMemo((()=>{const e=g?Object.keys(g):[];if(1===e.length&&n.isPlainObject(g[e[0]]))return e[0]}),[g]),[C,$]=d({},i?`${i}:errors`:void 0),[E,x]=t.useState(!1),[j,A]=t.useState(!1),[S,D]=t.useState(),[k,I]=t.useState(!1),[O,F]=t.useState(!1),P=t.useRef(null),w=t.useRef(null);let R=t.useRef((e=>e));const B=t.useRef(null);t.useEffect((()=>(B.current=!0,()=>{B.current=!1})),[]);let N=t.useRef(null),q=t.useRef(null);t.useEffect((()=>{N.current&&q.current&&N.current(...q.current)}),[g]);let T=!1;try{const e=m();T=e.railsAttributes}catch(e){}const V=(e,t,s={async:!1})=>{const u={...s,onCancelToken:e=>{if(P.current=e,s.onCancelToken)return s.onCancelToken(e)},onBefore:e=>{if(I(!1),F(!1),clearTimeout(w.current),s.onBefore)return s.onBefore(e)},onStart:e=>{if(A(!0),s.onStart)return s.onStart(e)},onProgress:e=>{if(D(e),s.onProgress)return s.onProgress(e)},onSuccess:e=>{if(B.current&&(A(!1),D(null),$({}),x(!1),I(!0),F(!0),w.current=setTimeout((()=>{B.current&&F(!1)}),2e3)),s.onSuccess)return s.onSuccess(e)},onError:e=>{if(B.current&&(A(!1),D(null),$((e=>{if(!e||!v)return e;const t={};return Object.keys(e).forEach((r=>{t[`${v}.${r}`]=e[r]})),t})(e)),x(!0)),s.onError)return s.onError(e)},onCancel:()=>{if(B.current&&(A(!1),D(null)),s.onCancel)return s.onCancel()},onFinish:e=>{if(B.current&&(A(!1),D(null)),P.current=null,s.onFinish)return s.onFinish(e)}};let a=R.current(structuredClone(g));T&&(a=((e,t="_attributes")=>{const r=structuredClone(e);return Object.values(r).forEach((e=>{n.isPlainObject(e)&&c(e,t)})),r})(a)),!0===s.async?(u.onBefore(void 0),u.onStart(void 0),o[e](t,a,{onUploadProgress:e=>{u.onProgress(e)}}).then((e=>{u.onSuccess(e)})).catch((e=>{u.onError(e)})).finally((()=>{u.onFinish(void 0)}))):"delete"===e?r.router.delete(t,{...u,data:a}):r.router[e](t,a,u)},_=e=>{if(!e)return void $({});const t=f(e);$((e=>{const r=Object.keys(e).reduce(((r,n)=>({...r,...t.length>0&&!t.includes(String(n))?{[n]:e[n]}:{}})),{});return x(Object.keys(r).length>0),r}))};return{data:g,isDirty:!n.isEqual(g,p),errors:C,hasErrors:E,processing:j,progress:S,wasSuccessful:k,recentlySuccessful:O,transform:e=>{R.current=e},onChange:e=>{N.current=e},setData:(e,t)=>{if("string"==typeof e)return b((r=>{const s=structuredClone(r);return N.current&&(q.current=[e,t,n.get(r,e)]),n.set(s,e,t),s}));e instanceof Function?b((t=>{const r=e(structuredClone(t));return N.current&&(q.current=[void 0,r,t]),r})):(N.current&&(q.current=[void 0,g,e]),b(e))},getData:e=>n.get(g,e),unsetData:e=>{b((t=>{const r=structuredClone(t);return N.current&&(q.current=[e,n.get(t,e),void 0]),l(r,e),r}))},setDefaults:(e,t)=>{y(void 0!==e?r=>({...r,..."string"==typeof e?{[e]:t}:e}):()=>g)},reset:e=>{if(!e)return N.current&&(q.current=[void 0,p,g]),b(p),void $({});const t=f(e),r=structuredClone(g);t.forEach((e=>{n.set(r,e,n.get(p,e))})),_(e),N.current&&(q.current=[void 0,r,g]),b(r)},setError:(e,t)=>{$((r=>{const n={...r,..."string"==typeof e?{[e]:t}:e};return x(Object.keys(n).length>0),n}))},getError:e=>n.get(C,e),clearErrors:_,submit:V,get:(e,t)=>{V("get",e,t)},post:(e,t)=>{V("post",e,t)},put:(e,t)=>{V("put",e,t)},patch:(e,t)=>{V("patch",e,t)},delete:(e,t)=>{V("delete",e,t)},cancel:()=>{P.current&&P.current.cancel()}}}const[b,v]=(()=>{const e=t.createContext(null);return[()=>{const r=t.useContext(e);if(null===r)throw new Error("useContext must be inside a Provider with a value");return r},e.Provider]})(),C=({children:e,model:r,data:n,method:o="post",to:u,async:a=!1,resetAfterSubmit:c,remember:i=!0,filter:d,onChange:f,onSubmit:m,onBefore:h,onStart:p,onSuccess:y,onError:b,onFinish:C,...$})=>{const E=t.useCallback((e=>{if(!d)return e;const t=structuredClone(e);return d.forEach((e=>{l(t,e)})),t}),[n,d]),x=i?g(`${o}/${r||u}`,E(n)):g(E(n)),j=t.useCallback((()=>({...x,model:r,method:o,to:u,submit:A})),[n,x,x.data,x.errors,r,o,u]),A=async e=>{if(!u||!1!==m?.(j()))return x.submit(o,u,{...e,async:!0===a})};return t.useEffect((()=>{new URL(window.location.href).searchParams.forEach(((e,t)=>{x.setData(t,e)}))}),[]),t.useEffect((()=>{f?.(j())}),[x.data]),t.useEffect((()=>{b?.(j())}),[x.errors]),s.jsx(v,{value:j(),children:s.jsx("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation();const t={onSuccess:()=>{(c||!1!==c&&!0===a)&&x.reset(),y?.(j())}};h&&(t.onBefore=()=>{h(j())}),p&&(t.onStart=()=>{p(j())}),C&&(t.onFinish=()=>{C(j())}),A(t)},...$,children:e})})},[$,E]=u(),x=({children:e,model:r})=>{let n=r;try{const e=$();n="["===r.charAt(0)?`${e}${r}`:`${e}.${r}`}catch(e){}const{addAttribute:o}=m();return t.useEffect((()=>{o(r)}),[]),s.jsx(E,{value:n,children:Array.isArray(e)?e.map(((e,r)=>t.cloneElement(e,{key:r}))):e})},j=(e,t)=>{if(!t)return{inputId:e,inputName:e};let r;return r="["===e.charAt(0)?`${t}${e}`:`${t}.${e}`,{inputId:`${t}_${e}`.replace(".","_").replace(/\[(\d)\]/,"_$1"),inputName:r}},A=({name:e,model:r,defaultValue:n,errorKey:s,strategy:o=j,clearErrorsOnChange:u=!0})=>{const a=b();let c=r??a.model;try{c+=`.${$()}`}catch(e){}const{inputName:i,inputId:l}=o(e,c),d=t.useRef(!0);t.useEffect((()=>{if(!d.current)return;const e=a.getData(i);null==e&&a.setData(i,n||""),d.current=!1}),[]);const f=a.getData(i),m=s??i,h=a.getError(m);return t.useEffect((()=>{!d.current&&u&&h&&a.clearErrors(m)}),[f]),{form:a,inputName:i,inputId:l,value:f??"",setValue:e=>a.setData(i,e),error:h}},S=t.forwardRef((({children:e,type:r="submit",disabled:o=!1,component:u="button",requiredFields:a,...c},i)=>{const{data:l,getData:d,processing:f}=b(),m=t.useCallback((()=>!(!a||0===a.length)&&a.some((e=>{return null==(t=d(e))||("string"==typeof t?""===t:"number"==typeof t?0!==t&&!Boolean(t):t instanceof Date?isNaN(t.valueOf()):"boolean"!=typeof t&&n.isEmpty(t));var t}))),[l,a]);return s.jsx(u,{children:e,type:r,disabled:o||f||a&&m(),ref:i,...c})}));var D=t.memo(S);const k=({model:e,emptyData:r})=>{const{setData:s,unsetData:o,getData:u}=b(),{model:a}=m();let c=a??"";try{const e=$();c=a?`${c}.${e}`:e}catch(e){}c=`${c}.${e||""}`;const i=t.useCallback((e=>{s((t=>{const s=structuredClone(t);let o=n.get(s,c);o&&Array.isArray(o)||(n.set(s,c,[]),o=n.get(s,c));let u={};return e instanceof Function?u=e(o):void 0!==e&&(u=e),o.push(Object.assign(r,u)),n.set(s,c,o),s}))}),[]),l=t.useCallback((e=>{const t=u(`${c}[${e}]`);return o(`${c}[${e}]`),t}),[]),d=u(c);return{addInput:i,removeInput:l,paths:t.useCallback((()=>Array.isArray(d)?d.map(((t,r)=>`${e||""}[${r}]`)):[]),[d])()}};e.DynamicInputs=({children:e,model:r,emptyData:n,addInputButton:o=s.jsx("button",{children:"+"}),removeInputButton:u=s.jsx("button",{children:"-"})})=>{const{addInput:a,removeInput:c,paths:i}=k({model:r,emptyData:n});return s.jsxs(s.Fragment,{children:[t.cloneElement(o,{onClick:()=>a(),type:"button"}),i.map(((r,n)=>s.jsxs(x,{model:r,children:[s.jsx("div",{children:e}),t.cloneElement(u,{onClick:()=>c(n),type:"button"})]},n)))]})},e.Form=({children:e,model:t,railsAttributes:r=!1,...n})=>s.jsx(y,{model:t,railsAttributes:r,children:s.jsx(C,{model:t,...n,children:e})}),e.Input=({name:e,component:t="input",type:r="text",model:n,onChange:o,errorKey:u,defaultValue:a,clearErrorsOnChange:c,...i})=>{const{form:l,inputName:d,inputId:f,value:m,setValue:h}=A({name:e,model:n,errorKey:u,defaultValue:a,clearErrorsOnChange:c}),p=t;return s.jsx(p,{type:r,name:d,id:f,value:m,onChange:e=>{const t=e.target?.checked||e.target.value;h(t),o?.(t,l)},...i})},e.NestedFields=x,e.Submit=D,e.useDynamicInputs=k,e.useForm=b,e.useInertiaForm=g,e.useInertiaInput=A}));
//# sourceMappingURL=useInertiaForm.umd.min.js.map
